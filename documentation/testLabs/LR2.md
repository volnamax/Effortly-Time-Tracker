# Лабораторная работа №2

## Задание

1. Написать **integration-тесты** для компонентов доступа к данным и бизнес-логики выбранного проекта:
    - Интеграционные тесты должны включать взаимодействие с хранилищем данных (SQL, NoSQL, file storage и др.).
    - Для тестов должен инициализироваться отдельный инстанс хранилища.
    - Поднимать инстанс хранилища с помощью последовательного запуска скриптов:
        - Генерация таблиц.
        - Заведение тестовых данных.
        - Откат состояния на исходное после завершения тестов.

2. Написать **E2E-тест** для демонстрационного сценария (например, сценарий, использованный при защите MVP).

3. Организовать запуск тестов из лабораторной работы №1 и вновь добавленных в рамках работы №2 в любой CI/CD среде (например, GitLab, Jenkins, TeamCity и др.):
    - Настроить порядок запуска тестов в CI/CD:
        1. Unit-тесты.
        2. Integration-тесты.
        3. E2E-тесты.
    - При сбое одного из этапов следующие не запускаются, но автоматический отчет формируется:
        - Не выполненные этапы помечаются как **skipped** или **ignored**.
    - Если свалился **integration** или **E2E** этап, требуется откатить состояние хранилища на исходное.

4. Имитация действий из E2E-теста:
    - Использовать средство для отправки запросов (например, Postman, Curl и др.).
    - Снять логи с помощью средства захвата трафика (если проект не предполагает такие действия, согласовать с преподавателем).

---

## Требования

### Общие требования
1. Оформить запуск тестов в виде отдельного Docker-контейнера:
    - Выкачивание репозитория с кодом.
    - Установка внешних зависимостей.
    - Запуск тестов на используемом языке программирования.
    - Контейнер для тестов должен вызываться внутри CI/CD среды.
2. Инстанс хранилища для тестов должен быть идентичен при каждом запуске.
3. Тесты должны быть многократно запускаемы:
    - Результаты тестов не изменяются при повторных запусках.
    - Возможность одновременного запуска тестов несколькими разработчиками локально.

---

### Интеграционные тесты
1. Минимум 2 теста, где тестируются только 2 класса без моков/стабов других классов.
2. Минимум 2 теста, где тестируется взаимодействие минимум двух классов с использованием моков/стабов остальных компонентов.
3. Интеграционные тесты должны следовать паттерну **Arrange-Act-Assert**:
    - Arrange: Подготовка тестовых данных и окружения.
    - Act: Выполнение действий.
    - Assert: Проверка результатов.

---

### E2E-тесты
1. **E2E-тесты** должны включать взаимодействие с базой данных, которая инициализируется из схемы, хранящейся в системе контроля версий.
2. Взаимодействие с UI не требуется — имитировать события через вспомогательные инструменты (например, отправка запросов).
3. Использовать несколько секций **Act-Assert** для демонстрации сценариев.
4. Убедиться, что E2E-тесты могут быть запущены в режиме многократного выполнения (от 100 до 1000 раз), результаты успешных запусков фиксируются.

---

### CI/CD
1. Последовательность этапов:
    - **Unit-тесты → Integration-тесты → E2E-тесты**.
2. Автоматический отчет генерируется при завершении тестов.
3. Если используется **Service Bus**, Message Broker или аналогичный инструмент:
    - После завершения тестов (успешного или аварийного) все сообщения в очередях должны быть обработаны.
4. Если проект использует хранение активных сессий пользователей:
    - Все активные сессии должны быть завершены после завершения тестов.

---

### Рекомендации по оформлению тестов
1. Один файл — один тест, включающий несколько секций (Arrange, Act, Assert).
2. Для Unit-тестов используйте суффиксы (`test`, `_test`, и т.д. в зависимости от языка программирования).
3. Для интеграционных тестов применяйте расширения, соответствующие языку, например:
    - Java: `ITCase` (Integration Test Case).

---

### Итоги
1. Все тесты (Unit, Integration, E2E) должны быть успешными.
2. Обеспечить возможность их выполнения в любых средах (локально, в CI/CD).
3. Настроить полное автоматическое тестирование с использованием современных CI/CD практик.
